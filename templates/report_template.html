<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Cloud Logs Analysis Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
        }
        .header .timestamp {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-top: 10px;
        }
        .executive-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .executive-summary h2 {
            margin-top: 0;
            font-size: 1.8em;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            color: #2c3e50;
            border-left: 4px solid #e74c3c;
            padding-left: 15px;
            font-size: 1.6em;
        }
        .chart-container {
            margin: 20px 0;
            text-align: center;
        }
        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .findings-list {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .findings-list ul {
            margin: 0;
            padding-left: 20px;
        }
        .findings-list li {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .risk-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }
        .risk-low { background-color: #27ae60; }
        .risk-medium { background-color: #f39c12; }
        .risk-high { background-color: #e74c3c; }
        .recommendations {
            background: #d5f4e6;
            border-left: 4px solid #27ae60;
            padding: 20px;
            margin: 20px 0;
        }
        .alert-box {
            background: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 15px;
            margin: 15px 0;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #bdc3c7;
            color: #7f8c8d;
        }
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Oracle Cloud Infrastructure</h1>
            <h2>Log Analysis Report</h2>
            <div class="timestamp">Generated on {{ timestamp }}</div>
        </div>

        <!-- Executive Summary -->
        <div class="executive-summary">
            <h2>Executive Summary</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number">{{ summary.total_logs_analyzed | default(0) }}</span>
                    <span>Total Logs Analyzed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ summary.unique_countries | default(0) }}</span>
                    <span>Unique Countries</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ summary.top_country | default('N/A') }}</span>
                    <span>Top Country</span>
                </div>
                <div class="stat-card">
                    <span class="risk-indicator risk-{{ summary.risk_level | lower }}">{{ summary.risk_level | default('Medium') }}</span>
                    <span>Risk Level</span>
                </div>
            </div>
            
            {% if summary.executive_summary %}
            <div style="margin-top: 20px;">
                <h3>Key Insights:</h3>
                <p>{{ summary.executive_summary }}</p>
            </div>
            {% endif %}
        </div>

        <!-- AI Analysis Results -->
        <div class="section">
            <h2>ü§ñ AI-Powered Analysis Results</h2>
            
            {% if nim_analysis.key_findings %}
            <div class="findings-list">
                <h3>Key Findings:</h3>
                <ul>
                {% for finding in nim_analysis.key_findings %}
                    <li>{{ finding }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if nim_analysis.security_analysis %}
            <div class="alert-box">
                <h3>üîí Security Analysis:</h3>
                <p>{{ nim_analysis.security_analysis }}</p>
            </div>
            {% endif %}

            {% if nim_analysis.anomalies %}
            <div class="alert-box" style="background: #fab1a0; border-color: #e17055;">
                <h3>‚ö†Ô∏è Detected Anomalies:</h3>
                <p>{{ nim_analysis.anomalies }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Traffic Analytics Charts -->
        <div class="section">
            <h2>üìä Traffic Analytics</h2>
            
            <div class="two-column">
                <div class="chart-container">
                    <h3>Country Distribution</h3>
                    {% if charts.country_distribution %}
                    <img src="{{ charts.country_distribution }}" alt="Country Traffic Distribution">
                    {% else %}
                    <p>Chart not available</p>
                    {% endif %}
                </div>
                
                <div class="chart-container">
                    <h3>Protocol Usage</h3>
                    {% if charts.protocol_usage %}
                    <img src="{{ charts.protocol_usage }}" alt="Protocol Usage Distribution">
                    {% else %}
                    <p>Chart not available</p>
                    {% endif %}
                </div>
            </div>

            <div class="chart-container">
                <h3>Traffic Timeline (24 Hours)</h3>
                {% if charts.traffic_timeline %}
                <img src="{{ charts.traffic_timeline }}" alt="Traffic Timeline">
                {% else %}
                <p>Chart not available</p>
                {% endif %}
            </div>

            <div class="chart-container">
                <h3>Geographic Distribution</h3>
                {% if charts.geographic_heatmap %}
                <img src="{{ charts.geographic_heatmap }}" alt="Geographic Distribution">
                {% else %}
                <p>Chart not available</p>
                {% endif %}
            </div>
        </div>

        <!-- Security Analysis -->
        {% if charts.security_analysis %}
        <div class="section">
            <h2>üõ°Ô∏è Security Analysis</h2>
            <div class="chart-container">
                <img src="{{ charts.security_analysis }}" alt="Security Risk Analysis">
            </div>
        </div>
        {% endif %}

        <!-- Recommendations -->
        {% if nim_analysis.recommendations %}
        <div class="section">
            <h2>üí° Recommendations</h2>
            <div class="recommendations">
                <p>{{ nim_analysis.recommendations }}</p>
            </div>
        </div>
        {% endif %}

        <!-- Technical Details -->
        <div class="section">
            <h2>üìã Technical Details</h2>
            
            <div class="two-column">
                <div>
                    <h3>Analysis Parameters:</h3>
                    <ul>
                        <li><strong>Time Range:</strong> {{ analysis_data.current_period.time_range | default('24h') }}</li>
                        <li><strong>Data Sources:</strong> Oracle Cloud Infrastructure Logs</li>
                        <li><strong>AI Model:</strong> NVIDIA NIM ({{ nim_analysis.model | default('Llama-3.1-405B') }})</li>
                        <li><strong>Analysis Type:</strong> Automated Security & Traffic Analysis</li>
                    </ul>
                </div>
                
                <div>
                    <h3>Data Quality Metrics:</h3>
                    <ul>
                        <li><strong>Completeness:</strong> {{ analysis_data.summary_statistics.completeness | default('95%') }}</li>
                        <li><strong>Processing Time:</strong> {{ analysis_data.processing_time | default('< 2 minutes') }}</li>
                        <li><strong>Confidence Level:</strong> {{ nim_analysis.confidence | default('High') }}</li>
                        <li><strong>Last Updated:</strong> {{ timestamp }}</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>This report was automatically generated by the Oracle Cloud Logs Analysis System</p>
            <p>Powered by NVIDIA NIM AI and Oracle Cloud Infrastructure</p>
            <p><em>Report ID: {{ timestamp | replace(' ', '_') | replace(':', '') | replace('-', '') }}</em></p>
        </div>
    </div>
</body>
</html>
